name: 'Conditional Composite'
description: 'Test composite run step conditionals'
inputs:
  exit-code:
    description: 'Action fails if set to non-zero'
    default: '0'
  child-exit-code:
    description: 'Nested Action fails if set to non-zero'
    default: '0'
outputs:
  success: 
    description: 'Set to 1 if action succeeded'
    value: ${{ steps.success.outputs.result }}
  failure: 
    description: 'Set to 1 if action failed'
    value: ${{ steps.success.outputs.failure }}

outputs:
  status-error:
    description: "Statuses should not match if exit-codes are different"
    value: ${{ steps.status-error.outputs.status-error }}

runs:
    using: "composite"
    steps:
      - run: exit ${{ inputs.exit-code }}
        shell: bash

      - uses: ./action-status
        id: action-status
        with:
          exit-code: ${{ inputs.child-exit-code }}

      - run: if [ ${{ (inputs.exit-code != inputs.child-exit-code && github.action_status == steps.action-status.status-after) || (inputs.exit-code == inputs.child-exit-code && github.action_status != steps.action-status.status-after) }} ] then echo "::set-output name=status-error::1"
        id: status-error
        shell: bash

      - run: echo "::set-output name=result::1"
        id: success
        shell: bash

      - run: echo "::set-output name=result::1"
        id: failure
        shell: bash
        if: failure()